(this.webpackJsonpweb=this.webpackJsonpweb||[]).push([[0],[,,,,,,,,,,,,function(e,t,a){e.exports=a(24)},,,,,function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},,function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(11),o=a.n(i),s=(a(17),a(3)),c=a.n(s),l=a(8),h=a(1),u=a(2),p=a(5),f=a(4),d=a(6),v=(a(19),a(20),"pismo-server-picker-servers");var m=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(p.a)(this,Object(f.a)(t).call(this,e))).serverNameInput=void 0,a.serverAddressInput=void 0,a.state={serversList:[]},a.serverNameInput=n.a.createRef(),a.serverAddressInput=n.a.createRef(),a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"checkServerStatus",value:function(){var e=Object(l.a)(c.a.mark((function e(t){var a,r,n,i=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=function(e){t.status=e,i.setState(i.state)})("pinging..."),r="http://".concat(t.address,"/version"),n=null,e.prev=4,e.next=7,fetch(r);case 7:n=e.sent,e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(4),a("offline: "+e.t0),e.abrupt("return");case 14:if(n.ok){e.next=17;break}return a("offline: !fetchResponse.ok"),e.abrupt("return");case 17:a("online!");case 18:case"end":return e.stop()}}),e,null,[[4,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"updateStateFromLocalStorage",value:function(){var e=this,t=function(){var e=window.localStorage.getItem(v);return e?JSON.parse(e):[]}(),a=!0,r=!1,n=void 0;try{for(var i,o=function(){var t=i.value;(function(){var a=!0,r=!1,n=void 0;try{for(var i,o=e.state.serversList[Symbol.iterator]();!(a=(i=o.next()).done);a=!0){var s=i.value;if(s.name===t.name&&s.address===t.address)return!1}}catch(c){r=!0,n=c}finally{try{a||null==o.return||o.return()}finally{if(r)throw n}}return!0})()&&(e.state.serversList.push(t),e.checkServerStatus(t))},s=t[Symbol.iterator]();!(a=(i=s.next()).done);a=!0)o()}catch(c){r=!0,n=c}finally{try{a||null==s.return||s.return()}finally{if(r)throw n}}this.setState(this.state)}},{key:"storageEventListener",value:function(e){e.key===v&&this.updateStateFromLocalStorage()}},{key:"componentDidMount",value:function(){window.addEventListener("storage",this.storageEventListener),this.updateStateFromLocalStorage()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("storage",this.storageEventListener)}},{key:"addServer",value:function(e){this.state.serversList.push(e),window.localStorage.setItem(v,JSON.stringify(this.state.serversList)),this.checkServerStatus(e)}},{key:"removeServer",value:function(e){var t=this.state.serversList.indexOf(e);t>-1&&this.state.serversList.splice(t,1),window.localStorage.setItem(v,JSON.stringify(this.state.serversList)),this.setState(this.state)}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"serverpicker"},n.a.createElement("div",{style:{display:"block",border:"1px solid black"}},"Add a server:",n.a.createElement("div",null,n.a.createElement("label",null,"Server Name (optional)",n.a.createElement("input",{ref:this.serverNameInput}))),n.a.createElement("div",null,n.a.createElement("label",null,"Server Address",n.a.createElement("input",{ref:this.serverAddressInput}))),n.a.createElement("button",{onClick:function(){var t={name:e.serverNameInput.current?e.serverNameInput.current.value:"",address:e.serverAddressInput.current?e.serverAddressInput.current.value:""};e.addServer(t)}},"Add")),n.a.createElement("div",null,this.state.serversList.map((function(t){return n.a.createElement("div",{style:{border:"1px solid"},key:"".concat(t.name,"-").concat(t.address)},n.a.createElement("div",{style:{cursor:"pointer"},onClick:function(){return e.props.onServerPicked(t.address)}},t.name?n.a.createElement("div",null,"name: ",t.name):"",n.a.createElement("div",null,"address: ",t.address),n.a.createElement("div",null,"status: ",t.status)),n.a.createElement("button",{onClick:function(){e.removeServer(t)}},"Remove"))}))))}}]),t}(n.a.Component),g=function(){function e(t){Object(h.a)(this,e),this.hostname=void 0,this.hostname=t}return Object(u.a)(e,[{key:"getTrees",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._makeFetch("get-trees",{includeRemotes:!0});case 2:return t=e.sent,e.next=5,t.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_makeFetch",value:function(){var e=Object(l.a)(c.a.mark((function e(t,a){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://"+this.hostname+"/api",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({method:t,params:a})});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()}]),e}(),b=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(p.a)(this,Object(f.a)(t).call(this,e))).state=void 0,a.state={finished:!1},e.promise.then((function(){a.setState({finished:!0})})),a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return this.state.finished?n.a.createElement("p",null,"finished!"):n.a.createElement("p",null,"loading...")}}]),t}(n.a.Component),w=function(e){function t(e){var a;Object(h.a)(this,t),(a=Object(p.a)(this,Object(f.a)(t).call(this,e))).state=void 0;var r=e.getTreesResponse.trees;return r||console.error("!trees"),r.length||console.error("!trees.length"),a.state={left:r[0].treename,right:r[0].treename},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"renderBranches",value:function(e){var t=this;return this.props.getTreesResponse.trees.map((function(a,r){var i=a.treename,o="".concat(e,"-").concat(i);return n.a.createElement("div",{key:o},n.a.createElement("label",null,n.a.createElement("input",{type:"radio",name:e,checked:t.state[e]===i,onChange:function(a){if(a.target.checked){var r={};r[e]=i,t.setState(r)}}}),i))}))}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"branches-picker"},n.a.createElement("div",{className:"split-container"},n.a.createElement("div",{className:"split-child"},this.renderBranches("left")),n.a.createElement("div",{className:"split-child"},this.renderBranches("right"))),n.a.createElement("div",{className:"center"},n.a.createElement("button",{onClick:function(t){e.props.onBranchesPicked({leftBranchName:e.state.left,rightBranchName:e.state.right})}},"ikuzo")))}}]),t}(n.a.Component),y=a(7),k=(a(21),a(22),a(9)),E=a.n(k);var N=function(){function e(t,a){Object(h.a)(this,e),this.baseTree=void 0,this.otherTree=void 0,this.baseIndex=void 0,this.otherIndex=void 0,this.baseTree=t,this.otherTree=a,this.baseIndex=0,this.otherIndex=0}return Object(u.a)(e,[{key:"getNextFile",value:function(e,t){return t<e.files.length?e.files[t]:null}},{key:"getNextBaseFile",value:function(){return this.getNextFile(this.baseTree,this.baseIndex)}},{key:"getNextOtherFile",value:function(){return this.getNextFile(this.otherTree,this.otherIndex)}},{key:"areHeadsDifferent",value:function(){var e,t,a=this.getNextBaseFile(),r=this.getNextOtherFile();return!a||!r||(t=r,!((e=a).path===t.path&&e.mtimeS===t.mtimeS&&e.mtimeNs===t.mtimeNs&&e.size===t.size&&e.hash===t.hash))}},{key:"goToNextDiff",value:function(){for(;!this.areHeadsDifferent();)this.baseIndex++,this.otherIndex++}},{key:"hasNext",value:function(){return this.goToNextDiff(),this.baseIndex<this.baseTree.files.length||this.otherIndex<this.otherTree.files.length}},{key:"next",value:function(){if(!this.hasNext())return null;var e=this.getNextBaseFile(),t=this.getNextOtherFile();return!t||e&&e.path<t.path?(this.baseIndex++,[{treeFile:this.baseTree,fileInfo:e}]):!e||t.path<e.path?(this.otherIndex++,[{treeFile:this.otherTree,fileInfo:t}]):(this.baseIndex++,this.otherIndex++,[{treeFile:this.baseTree,fileInfo:e},{treeFile:this.otherTree,fileInfo:t}])}}]),e}();function S(e,t){for(var a=[],r=new N(e,t);r.hasNext();){var n=r.next(),i=Object(y.a)(n,2),o=i[0],s=o.treeFile,c=o.fileInfo,l=i[1];if(l)a.push({operator:l.fileInfo.hash===c.hash?"touch":"cp",operands:[{tree:"base",relativePath:c.path},{tree:"other",relativePath:l.fileInfo.path}]});else if(s===e)a.push({operator:"cp",operands:[{tree:"base",relativePath:c.path},{tree:"other",relativePath:c.path}]});else{if(s!==t)throw new Error("this should never happen");a.push({operator:"rm",operands:[{tree:"other",relativePath:c.path}]})}}return a}function O(e,t){for(var a=[],r=new N(e,t);r.hasNext();){var n=r.next(),i=Object(y.a)(n,2),o=i[0],s=o.treeFile,c=o.fileInfo,l=i[1];if(l)console.log('warning: file found on both sides: "'+c.path+'", using base'),a.push({operator:l.fileInfo.hash===c.hash?"touch":"cp",operands:[{tree:"base",relativePath:c.path},{tree:"other",relativePath:l.fileInfo.path}]});else if(s===e)a.push({operator:"cp",operands:[{tree:"base",relativePath:c.path},{tree:"other",relativePath:c.path}]});else if(s!==t)throw new Error("this should never happen")}return a}var x=function(e){function t(e){var a;Object(h.a)(this,t),(a=Object(p.a)(this,Object(f.a)(t).call(this,e))).rows=void 0,a.state=void 0,a.leftTreeFile=void 0,a.rightTreeFile=void 0,a.lastPathModified=void 0,a.hashToDuplicateFiles=void 0,a.state={expandedPaths:new Set,viewStyle:"all",pathToMergeOperations:new Map,hashToDupeData:new Map};var r=e.getTreesResponse,n=e.leftBranchName,i=e.rightBranchName,o=r.trees.find((function(e){return e.treename===n})),s=r.trees.find((function(e){return e.treename===i}));if(!o)throw new Error("cant find tree with name: "+n);if(!s)throw new Error("cant find tree with name: "+i);var c=o.treefile,l=s.treefile;a.leftTreeFile=c,a.rightTreeFile=l,a.rows=[];for(var u=c.files,d=l.files,v=0,m=0;v<u.length||m<d.length;){var g=v<u.length?u[v].path:null,b=m<d.length?d[m].path:null;!g||b&&b<g?a.rows.push({right:d[m++]}):!b||g<b?a.rows.push({left:u[v++]}):a.rows.push({right:d[m++],left:u[v++]})}var w=new Map,y=function(e,t){var a=w.get(e.hash);a||(a={left:[],right:[]},w.set(e.hash,a)),a[t].push(e)};return a.leftTreeFile.files.forEach((function(e){return y(e,"left")})),a.rightTreeFile.files.forEach((function(e){return y(e,"right")})),a.hashToDuplicateFiles=new Map,w.forEach((function(e,t){var r=e.left.length>1||e.right.length>1,n=e.left.length&&e.right.length&&e.left[0].path!==e.right[0].path;(r||n)&&a.hashToDuplicateFiles.set(t,e)})),a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"generateMergeFile",value:function(){var e={baseBranch:this.props.leftBranchName,otherBranch:this.props.rightBranchName,operations:[]},t=function(t){var a=[],r=[],n=[],i=[],o=!0,s=!1,c=void 0;try{for(var l,h=t[Symbol.iterator]();!(o=(l=h.next()).done);o=!0){var u=l.value;switch(u.operator){case"cp":a.push(u);break;case"rm":r.push(u);break;case"touch":n.push(u);break;case"mv":i.push(u)}}}catch(p){s=!0,c=p}finally{try{o||null==h.return||h.return()}finally{if(s)throw c}}e.operations=e.operations.concat(i),e.operations=e.operations.concat(a),e.operations=e.operations.concat(r),e.operations=e.operations.concat(n)};return this.state.pathToMergeOperations.forEach(t),this.state.hashToDupeData.forEach((function(e){return t(e.operations)})),e}},{key:"apply",value:function(){var e=this.generateMergeFile();fetch("http://"+this.props.hostname+"/apply",{method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json"}}).catch((function(e){console.log("fetch /apply error: ",e)}))}},{key:"save",value:function(){var e=this.generateMergeFile(),t=JSON.stringify(e,null,2),a=new Blob([t],{type:"text/plain"}),r=document.createElement("a");r.download="merge.json",r.href=window.URL.createObjectURL(a),r.click()}},{key:"toggleExpanded",value:function(e){var t=this.state.expandedPaths;t.has(e)?t.delete(e):t.add(e),this.setState({expandedPaths:t})}},{key:"renderViewPicker",value:function(){var e=this;return n.a.createElement("span",{style:{border:"1px solid black"}},"view:",n.a.createElement("label",null,n.a.createElement("input",{type:"radio",name:"view-all",checked:"all"===this.state.viewStyle,onChange:function(t){t.target.checked&&e.setState({viewStyle:"all"})}}),"all"),n.a.createElement("label",null,n.a.createElement("input",{type:"radio",name:"view-only-diff",checked:"onlyDiff"===this.state.viewStyle,onChange:function(t){t.target.checked&&e.setState({viewStyle:"onlyDiff"})}}),"only diff"),n.a.createElement("label",null,n.a.createElement("input",{type:"radio",name:"view-only-operations",checked:"onlyChanges"===this.state.viewStyle,onChange:function(t){t.target.checked&&e.setState({viewStyle:"onlyChanges"})}}),"only changes"),n.a.createElement("label",null,n.a.createElement("input",{type:"radio",name:"view-only-duplicates",checked:"onlyDuplicates"===this.state.viewStyle,onChange:function(t){t.target.checked&&e.setState({viewStyle:"onlyDuplicates"})}}),"duplicates"))}},{key:"overwriteOperations",value:function(e){var t=new Map,a=!0,r=!1,n=void 0;try{for(var i,o=e[Symbol.iterator]();!(a=(i=o.next()).done);a=!0){var s=i.value,c=s.operands[0].relativePath,l=[];t.has(c)&&(l=t.get(c)),l.push(s),t.set(c,l)}}catch(h){r=!0,n=h}finally{try{a||null==o.return||o.return()}finally{if(r)throw n}}this.setState({pathToMergeOperations:t})}},{key:"renderPresetPicker",value:function(){var e=this;return n.a.createElement("span",{style:{border:"1px solid black"}},"apply preset:",n.a.createElement("button",{onClick:function(){return e.overwriteOperations(S(e.leftTreeFile,e.rightTreeFile))}},'mirror "',this.props.leftBranchName,'" => "',this.props.rightBranchName,'"'),n.a.createElement("button",{onClick:function(){return e.overwriteOperations(S(e.rightTreeFile,e.leftTreeFile))}},'mirror "',this.props.rightBranchName,'" => "',this.props.leftBranchName,'"'),n.a.createElement("button",{onClick:function(){return e.overwriteOperations(O(e.leftTreeFile,e.rightTreeFile))}},'one way update "',this.props.leftBranchName,'" => "',this.props.rightBranchName,'"'),n.a.createElement("button",{onClick:function(){return e.overwriteOperations(O(e.rightTreeFile,e.leftTreeFile))}},'one way update "',this.props.rightBranchName,'" => "',this.props.leftBranchName,'"'),n.a.createElement("button",{onClick:function(){return e.overwriteOperations(function(e,t){for(var a=[],r=new N(e,t);r.hasNext();){var n=r.next(),i=Object(y.a)(n,2),o=i[0],s=o.treeFile,c=o.fileInfo,l=i[1];if(l)a.push({operator:l.fileInfo.hash===c.hash?"touch":"cp",operands:[{tree:"base",relativePath:c.path},{tree:"other",relativePath:l.fileInfo.path}]});else if(s===e)a.push({operator:"cp",operands:[{tree:"base",relativePath:c.path},{tree:"other",relativePath:c.path}]});else{if(s!==t)throw new Error("this should never happen");a.push({operator:"cp",operands:[{tree:"other",relativePath:c.path},{tree:"base",relativePath:c.path}]})}}return a}(e.leftTreeFile,e.rightTreeFile))}},"two-way merge"))}},{key:"revertChangesBelowLastChange",value:function(){if(this.lastPathModified){var e=new Set;if(this.state.pathToMergeOperations.forEach((function(t,a){e.add(a)})),e.has(this.lastPathModified)){var t=[];e.forEach((function(e){t.push(e)})),t.sort();for(var a=new Set,r=t.indexOf(this.lastPathModified),n=0;n<=r;n++)a.add(t[n]);var i=new Map;this.state.pathToMergeOperations.forEach((function(e,t){a.has(t)&&i.set(t,e)})),this.setState({pathToMergeOperations:i})}}}},{key:"renderBanner",value:function(){var e=this;return n.a.createElement("div",{className:"sticky"},n.a.createElement("div",null,n.a.createElement("button",{className:"comparer-left-button",onClick:function(){return e.save()}},"save"),n.a.createElement("button",{onClick:function(){return e.apply()}},"apply"),this.renderViewPicker(),this.renderPresetPicker(),n.a.createElement("button",{onClick:function(){return e.revertChangesBelowLastChange()}},"revert all changes below last change")),n.a.createElement("div",{className:"split-container"},n.a.createElement("div",{className:"split-child comparer-branch-title"},this.props.leftBranchName),n.a.createElement("div",{className:"split-child comparer-branch-title"},this.props.rightBranchName)))}},{key:"getMergeOperationsForPath",value:function(e){return this.state.pathToMergeOperations.has(e)||this.state.pathToMergeOperations.set(e,[]),this.state.pathToMergeOperations.get(e)}},{key:"setMergeOperationsForPath",value:function(e,t){this.lastPathModified=e;var a=this.state.pathToMergeOperations;a.set(e,t),this.setState({pathToMergeOperations:a})}},{key:"renderRow",value:function(e){var t=this,a="";if(e.left?a=e.left.path:e.right&&(a=e.right.path),!a)return console.error("this should never happen. row: ",e),[];var r=this.getMergeOperationsForPath(a),i=this.state.expandedPaths.has(a),o="onlyone";if(e.left&&e.right&&(o=e.left.hash===e.right.hash?e.left.mtimeS===e.right.mtimeS&&e.left.mtimeNs===e.right.mtimeNs?"same":"diffmtime":"diffhash"),"same"===o&&"onlyDiff"===this.state.viewStyle)return[];var s=e.left,c=e.right,l="none";if(r.length)switch(r[0].operator){case"rm":l="delete";break;case"cp":case"touch":l="copy"}if("none"===l&&"onlyChanges"===this.state.viewStyle)return[];var h=function(){if("none"!==l)return[n.a.createElement("button",{key:a+" comparer-button-row-child",className:"comparer-button-row-child",onClick:function(){t.setMergeOperationsForPath(a,[])}},"undo")];var e="left"+(s?s.path:"null")+"right"+(c?c.path:"null"),r=n.a.createElement("button",{key:"deleteButton"+e,className:"comparer-button-row-child comparer-left-button",onClick:function(){return function(){var e=[];s&&e.push({operator:"rm",operands:[{tree:"base",relativePath:a}]}),c&&e.push({operator:"rm",operands:[{tree:"other",relativePath:a}]}),t.setMergeOperationsForPath(a,e)}()}},"onlyone"===o?"delete":"delete both"),i=n.a.createElement("button",{key:"pickLeftButton"+e,className:"comparer-button-row-child comparer-pick-button",onClick:function(){t.setMergeOperationsForPath(a,[{operator:"diffmtime"===o?"touch":"cp",operands:[{tree:"base",relativePath:a},{tree:"other",relativePath:a}]}])}},"pick left"),h=n.a.createElement("button",{key:"pickRightButton"+e,className:"comparer-button-row-child comparer-pick-button",onClick:function(){t.setMergeOperationsForPath(a,[{operator:"diffmtime"===o?"touch":"cp",operands:[{tree:"other",relativePath:a},{tree:"base",relativePath:a}]}])}},"pick right");switch(o){case"same":return[r];case"onlyone":return s?[r,i]:[r,h];case"diffmtime":case"diffhash":return[r,i,h]}},u=function(){var e=s?"\u2b1b":"\u2b1c",i=c?"\u2b1b":"\u2b1c",h="white",u="".concat(e,"   ").concat(i),p="",f="";switch(l){case"none":switch(o){case"same":h="green",u="".concat(e," = ").concat(i),f='"'.concat(t.props.leftBranchName,'" and "').concat(t.props.rightBranchName,'" are identical');break;case"onlyone":h="red",u="".concat(e,"   ").concat(i),f=s?'"'.concat(t.props.leftBranchName,'" has this file, "').concat(t.props.rightBranchName,'" does not'):'"'.concat(t.props.leftBranchName,'" doesn\'t have this file, "').concat(t.props.rightBranchName,'" has it');break;case"diffhash":h="red",u="".concat(e," ~ ").concat(i),f="files have different contents";break;case"diffmtime":h="yellow",u="".concat(e," ~ ").concat(i),f="files have different modified time, but same content"}break;case"copy":h="blue";var d="base"===r[0].operands[0].tree?"\u2192":"\u2190";u="".concat(e," ").concat(d," ").concat(i),f='copying "'.concat(t.props.leftBranchName,'" ').concat(d,' "').concat(t.props.rightBranchName,'"');break;case"delete":h="blue",p="strikethrough",u="".concat(e,"   ").concat(i),f=s&&c?'deleting both "'.concat(t.props.leftBranchName,'"s and "').concat(t.props.rightBranchName,'"s copies of this file'):'deleting "'.concat(s?t.props.leftBranchName:t.props.rightBranchName,'"s copy of this file')}switch(h){case"white":break;case"blue":p+=" blue-bg-color";break;case"green":p+=" green-bg-color";break;case"red":p+=" error-bg-color";break;case"yellow":p+=" warning-bg-color"}return p+=" monospace comparer-status-icon",n.a.createElement("span",{key:a+" status icon",className:p,title:f}," ",u," ")},p=function(e,t){if(!e)return n.a.createElement("div",{className:"datagrid-cell disabled-bg-color center-text"},"not present");var a=function(e){var t=new Map;if(!e)return t;if(t.set("path",e.path),t.set("modified time",function(e){return new Date(1e3*e.mtimeS).toISOString()}(e)),t.set("size",E()(e.size)),t.set("hash",e.hash),e.customAttributeNameToValue)for(var a=0,r=Object.entries(e.customAttributeNameToValue);a<r.length;a++){var n=r[a],i=Object(y.a)(n,2),o=i[0],s=i[1];t.set(o,s)}return t},r=a(e),i=a(t);return n.a.createElement("div",{className:"datagrid-cell monospace"},n.a.createElement("table",{className:"table-borders"},n.a.createElement("tbody",null,Array.from(r).map((function(e){var t=Object(y.a)(e,2),a=t[0],r=t[1],o="";return i.get(a)!==r&&(o="warning-bg-color"),n.a.createElement("tr",{className:o},n.a.createElement("td",null,a),n.a.createElement("td",null,r))})))))},f=function(){var e=t.state.expandedPaths;e.has(a)?e.delete(a):e.add(a),t.setState({expandedPaths:e})},d=[n.a.createElement("div",{className:"datagrid-row comparer-border-bottom-soft clip-overflow",key:a},[n.a.createElement("div",{className:"comparer-button-row-container",key:a+" comparer-button-row-container"},h()),u(),n.a.createElement("span",{className:"monospace clip-overflow cursor-pointer",onClick:function(){return f()},key:a+" omaewa"},a)])];return i&&d.push(n.a.createElement("div",{className:"datagrid-row comparer-bottom-row"},n.a.createElement("div",{className:"datagrid-cell datagrid-row"},p(s),p(c)))),d}},{key:"renderDuplicatesRow",value:function(e,t,a,r,i){var o=this,s=[],c=function(e,r){var i=n.a.createElement("button",{title:"choose this path for all duplicate files",onClick:function(){return function(){var e=o.state.hashToDupeData;if(o.hashToDuplicateFiles.get(r.hash)){var n=[],i=function(e,t){if(e.length){var a=r.path,i="left"===t?"base":"other",o=function(e){n.push({operator:"rm",operands:[{tree:i,relativePath:e.path}]})};if(e.find((function(e){return e.path===a}))){var s=!0,c=!1,l=void 0;try{for(var h,u=e[Symbol.iterator]();!(s=(h=u.next()).done);s=!0){var p=h.value;p.path!==a&&o(p)}}catch(d){c=!0,l=d}finally{try{s||null==u.return||u.return()}finally{if(c)throw l}}}else{n.push({operator:"mv",operands:[{tree:i,relativePath:e[0].path},{tree:i,relativePath:a}]});for(var f=1;f<e.length;f++)o(e[f])}}};i(t,"left"),i(a,"right"),e.set(r.hash,{operations:n,selectedPath:r.path}),o.setState({hashToDupeData:e})}}()}},"choose this path"),c=n.a.createElement("button",{title:"undo changes for this hash",onClick:function(){return o.state.hashToDupeData.delete(r.hash),void o.setState({hashToDupeData:o.state.hashToDupeData})}},"undo"),l=o.state.hashToDupeData.get(r.hash);l&&(l.selectedPath,r.path);var h="none";l&&(h=l.selectedPath===r.path?"selecting":"deleting");var u=null,p="comparer-duplicates-path monospace";switch(h){case"none":u=i;break;case"deleting":u=n.a.createElement("button",{disabled:!0},"deleting"),p+=" strikethrough";break;case"selecting":u=c}s.push(n.a.createElement("div",{className:"comparer-duplicates-row-entry"},u,n.a.createElement("div",{className:"comparer-duplicates-branch"},"left"===e?o.props.leftBranchName:o.props.rightBranchName),n.a.createElement("div",{className:p},r.path)))};return t.forEach((function(e){return c("left",e)})),a.forEach((function(e){return c("right",e)})),[n.a.createElement("div",{className:"datagrid-row comparer-duplicates-title"},"hash: ",e,n.a.createElement("br",null)," left wasted space: ",E()(r),n.a.createElement("br",null),"right wasted space: ",E()(i))].concat(s)}},{key:"chooseLeftDuplicates",value:function(){throw new Error("TODO")}},{key:"chooseRightDuplicates",value:function(){throw new Error("TODO")}},{key:"renderDuplicates",value:function(){var e=this,t=Array.from(this.hashToDuplicateFiles.entries()).map((function(e){var t=Object(y.a)(e,2),a=t[0],r=t[1],n=function(e){return e.length<2?0:e[0].size*(e.length-1)};return{hash:a,left:r.left,right:r.right,leftWastedSpace:n(r.left),rightWastedSpace:n(r.right)}})).sort((function(e,t){var a=e.leftWastedSpace+e.rightWastedSpace,r=t.leftWastedSpace+t.rightWastedSpace;return a>r?-1:a<r?1:0}));return[n.a.createElement("button",{onClick:function(){return e.chooseLeftDuplicates()}},"choose left paths"),n.a.createElement("button",{onClick:function(){return e.chooseRightDuplicates()}},"choose right paths"),n.a.createElement("div",{className:"datagrid"},t.flatMap((function(t){return e.renderDuplicatesRow(t.hash,t.left,t.right,t.leftWastedSpace,t.rightWastedSpace)})))]}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"comparer"},this.renderBanner(),"onlyDuplicates"===this.state.viewStyle?this.renderDuplicates():n.a.createElement("div",{className:"datagrid"},this.rows.flatMap((function(t,a){return e.renderRow(t)}))))}}]),t}(n.a.Component),T=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(p.a)(this,Object(f.a)(t).call(this,e))).state=void 0,a.state={currentComponent:n.a.createElement("p",null,"hello world")},a.run().catch((function(e){a.setState({currentComponent:n.a.createElement("p",null,"error: ",e.stack)})})),a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"run",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,a,r,i,o,s,l,h,u=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){var t=n.a.createElement(m,{onServerPicked:e});u.state={currentComponent:t}}));case 2:return t=e.sent,a=new g(t),r=a.getTrees(),this.setState({currentComponent:n.a.createElement(b,{promise:r})}),e.next=8,r;case 8:if((i=e.sent).trees.length){e.next=12;break}return this.setState({currentComponent:n.a.createElement("p",null,"server has no trees!")}),e.abrupt("return");case 12:return e.next=14,new Promise((function(e){var t=n.a.createElement(w,{getTreesResponse:i,onBranchesPicked:e});u.setState({currentComponent:t})}));case 14:o=e.sent,s=o.leftBranchName,l=o.rightBranchName,h=n.a.createElement(x,{hostname:t,getTreesResponse:i,leftBranchName:s,rightBranchName:l}),this.setState({currentComponent:h});case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.state.currentComponent}}]),t}(n.a.Component),P=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function B(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}window.localStorage.getItem("pismoversion")||window.localStorage.setItem("pismoversion","0.0.1"),o.a.render(n.a.createElement(T,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");P?(!function(e,t){fetch(e).then((function(a){var r=a.headers.get("content-type");404===a.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):B(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):B(t,e)}))}}()}],[[12,1,2]]]);
//# sourceMappingURL=main.889ec902.chunk.js.map